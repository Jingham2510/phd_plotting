"""
Script that plots the force_displacement data generated by rob_controls force_displacement testing

data format:
linenum date/time [x,y,z] [force_x,force_y,force_z,force_Rx,force_Ry,force_Rz]


It will plot the position, forces, velocity and acceleration

"""

import matplotlib.pyplot as plt
from tools import *


#Organise the plotting
def main(filepath):

    datetimes = []
    pos = []
    forces = []



    #Open the file
    with open(filepath) as file:
        #Go through every line
        for line in file:
            #Ensure line is empty
            if line:
                #Split the line up
                tokens = data_split(line)         
                
                #Append the time data
                datetimes.append(tokens[0])

                #Append the position data
                pos.append(tokens[1])
                
                #Append the force data
                forces.append(tokens[2])


    #Calculate the time differences 
    time = calc_time_passed(datetimes)

    #Turn the positions into numbers
    pos = str_to_array(pos)
   

    #Turn the forces into numbers
    force = str_to_array(forces)


    #Check that the data arrays are the same lengths
    if(not len(time) == len(pos) == len(forces)):
        print("DATA ARRAYS ARE INCONSISTENT LENGTH")
        raise Exception()
    

    #Calculate the velocities
    vels = xyz_integ_avg(time, pos)   


    #Calculate the accelerations
    accs = xyz_integ_avg(time, three_arrs_to_threeD(vels[0], vels[1], vels[2]))

  
    #Create subfigure array for plots
    #We want to plot force vs pos?
    #Can decide later

    
    plot_pos_force(pos, force)

    return


#Split the line up
#Not the most efficient but thats okay for now 
def data_split(line):

    tokens = []

    #Can remove the line number
    line = line[line.find(",") + 1:]

    #Can remove the date - will always be same length
    DATE_LENGTH = 11
    line = line[DATE_LENGTH:]

    #Save the time
    tokens.append(line[:line.find(",")])

    #Remove the time 
    line = line[line.find(",") + 1:]

    #Save the positions
    tokens.append(line[:line.find("]") + 1])
    #Save the forces
    tokens.append(line[line.find("]") + 2:line.find("\n")])    

    return tokens



#Plot the  x vs y pos vs force
def plot_pos_force(pos, force):

    #collate the x poses and y poses
    x_pos = [x[0] for x in pos]
    y_pos = [x[1] for x in pos]

    #Represent the force as the sum of all of its parts (~worth looking into what alternatives there are)
    force_mag = [sum(x) for x in force]


    plt.plot(x_pos, y_pos)

    plt.show()





if __name__ == "__main__":
    print("FORCE DISPLACEMENT PLOTTING ------------------")

    filepath = "C:/Users/User/Documents/Results/first_pass_test/raw/test.txt"

    main(filepath)